<?xml version="1.0" encoding="UTF-8"?>
<Symbol IsArchivable="false" IsPlaceable="false" MainGUID="ECC7DD62-EC79-47F7-AB19-5B9132C83B64" MigrationValue="Normal" Owner="1196638531" Signature="1196644685" Version="43">
<Ancestry SectVersion="1" SectionFlags="0" SubIdent="0" Template="false">
	<MainGUID>F938E33A-329D-4A36-BE3E-85E126820996</MainGUID>
	<MainGUID>103E8D2C-8230-42E1-9597-46F84CCE28C0</MainGUID>
	<MainGUID>43EC5FE8-94F1-488F-8E9C-A63483E499C1</MainGUID>
</Ancestry>

<CalledMacros SectVersion="2" SectionFlags="0" SubIdent="0">
	<Macro>
		<MName><![CDATA["macro_spheric_coord"]]></MName>
		<MainGUID>DDAA950F-D2BF-4719-B4B4-38F4675419B4</MainGUID>
	</Macro>
	<Macro>
		<MName><![CDATA["macro_dotbydr"]]></MName>
		<MainGUID>C44894B0-4A96-4E45-9814-F75C5E40311D</MainGUID>
	</Macro>
	<Macro>
		<MName><![CDATA["macro_get_sort"]]></MName>
		<MainGUID>FEB7F942-C5B1-4441-8FEC-5FE35041A630</MainGUID>
	</Macro>
	<Macro>
		<MName><![CDATA["macro_get_profile"]]></MName>
		<MainGUID>D0DC3E6A-A675-4C29-AE55-263A7AA328FF</MainGUID>
	</Macro>
	<Macro>
		<MName><![CDATA["Показ_по_типам"]]></MName>
		<MainGUID>0DA25901-D04F-4AC0-8D04-87400B445F9E</MainGUID>
	</Macro>
	<Macro>
		<MName><![CDATA["Показ_по_группам"]]></MName>
		<MainGUID>7B4E6DAD-4C1D-422E-AD6A-F03F65C3A3B5</MainGUID>
	</Macro>
	<Macro>
		<MName><![CDATA["Показ_по_сборкам"]]></MName>
		<MainGUID>8CE26AA8-652F-4D4A-95D8-E7E763E145D4</MainGUID>
	</Macro>
	<Macro>
		<MName><![CDATA["Показ_систем"]]></MName>
		<MainGUID>815BEB36-F280-443A-937B-64990DB2FB36</MainGUID>
	</Macro>
	<Macro>
		<MName><![CDATA["Libraryflobals-km"]]></MName>
		<MainGUID>2087989F-7AAB-43CC-9F4A-8CC8975EA122</MainGUID>
	</Macro>
	<Macro>
		<MName><![CDATA["Libraryflobals-mep"]]></MName>
		<MainGUID>9799A140-EDFF-46BA-ACA1-B5401FE64F3E</MainGUID>
	</Macro>
	<Macro>
		<MName><![CDATA["MEP_m_RequestSystemGlobals"]]></MName>
		<MainGUID>5DC5ED79-B7C9-4B2A-A7A7-687FB97394F7</MainGUID>
	</Macro>
</CalledMacros>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_3D SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[
if not(haskey(profile_data.set.path)) then end
if not(haskey(profile_data.set.start)) then end
if vardim1(profile_data.set.start)<EPS then end
if haskey(profile_data.set.el_type_view_3d) then el_type_view = profile_data.set.el_type_view_3d
gosub "set_show_3d"
if not(show) or det_lvl_3d=0 then end
gosub "get_mat"
gosub "set_mat"
show_empty = 1
IF GLOB_CONTEXT=2 THEN det_lvl_3d = 1
if show_only_axsis then det_lvl_3d = 1
if GLOB_PREVIEW_MODE=1 or GLOB_PREVIEW_MODE=2 or GLOB_FEEDBACK_MODE=1 then
	gs_resol = 3
	det_lvl_3d = 1
else
	if GLOB_SEO_TOOL_MODE = 1 then
		gs_resol = 9
		show_empty = 0
	else
		if gs_resol<10 then gs_resol=12
	endif
endif

!Группа с построенным по пути профилем
group "profile"
	if haskey(profile_data.read._3d[det_lvl_3d].unput) then
		if NSP>0 then tt = max(get(nsp))
		tstart = NSP
		for i=1 to vardim1(profile_data.read._3d[det_lvl_3d].unput)
			if not(haskey(profile_data.read._3d[det_lvl_3d].unput[i].s)) then profile_data.read._3d[det_lvl_3d].unput[i].s = 15
			iStatus = profile_data.read._3d[det_lvl_3d].unput[i].s
			if (iStatus > 0) then iStatus = iStatus - iStatus % 100
			_d = 1 : if iStatus = 4000 or iStatus = 2000 then _d = 0
			if profile_data.read._3d[det_lvl_3d].unput[i].s>0 or show_empty then
				put profile_data.read._3d[det_lvl_3d].unput[i].x+dx*_d, profile_data.read._3d[det_lvl_3d].unput[i].y+dy*_d, profile_data.read._3d[det_lvl_3d].unput[i].s
			endif
		next i
		tend = NSP
		n_form = (tend - tstart)/3
		gosub "set_path"
		mask = 1+2+16+32
		TUBE n_form, n_path, mask, get(n_form*3+n_path*4)
		if NSP>0 then tt = max(get(nsp))
	endif
endgroup


!Копируем группу скольно надо раз
for i=1 to vardim1(profile_data.set.start)
	!Смещение
	if haskey(profile_data.set.start[i].x) then
		addx profile_data.set.start[i].x
		n_trans = n_trans + 1
	endif
	if haskey(profile_data.set.start[i].y) then
		addy profile_data.set.start[i].y
		n_trans = n_trans + 1
	endif
	if haskey(profile_data.set.start[i].z) then
		addz profile_data.set.start[i].z
		n_trans = n_trans + 1
	endif
	!Поворот
	if haskey(profile_data.set.start[i].rx) then
		rotx profile_data.set.start[i].rx
		n_trans = n_trans + 1
	endif
	if haskey(profile_data.set.start[i].ry) then
		roty profile_data.set.start[i].ry
		n_trans = n_trans + 1
	endif
	if haskey(profile_data.set.start[i].rz) then
		rotz profile_data.set.start[i].rz
		n_trans = n_trans + 1
	endif
	!Отражение
	if haskey(profile_data.set.start[i].mx) then
		if abs(profile_data.set.start[i].mx)>EPS and profile_data.set.start[i].mx<EPS then
			mulx -1
			n_trans = n_trans + 1
		endif
	endif
	if haskey(profile_data.set.start[i].my) then
		if abs(profile_data.set.start[i].my)>EPS and profile_data.set.start[i].my<EPS then
			muly -1
			n_trans = n_trans + 1
		endif
	endif
	if haskey(profile_data.set.start[i].mz) then
		if abs(profile_data.set.start[i].mz)>EPS and profile_data.set.start[i].mz<EPS then
			mulz -1
			n_trans = n_trans + 1
		endif
	endif
	placegroup "profile"
	if n_trans>0 then del n_trans
next i
end

"set_path":
	n_path = 0
	tstart = NSP
	for i=1 to vardim1(profile_data.set.path)
		put profile_data.set.path[i].x, profile_data.set.path[i].y, profile_data.set.path[i].z, profile_data.set.path[i].a
		hotspot profile_data.set.path[i].x, profile_data.set.path[i].y, profile_data.set.path[i].z
	next i
	tend = NSP
	n_path = (tend - tstart)/4
return

"set_mat":
	material col_mat
	pen gs_cont_pen
	fill gs_fill_type_sec
	line_type gs_line_type
	SECT_ATTRS gs_fill_type_sec, gs_back_pen, gs_fill_pen, gs_sec_pen, gs_line_type
return

"set_show_3d":
	success = LIBRARYGLOBAL ("Libraryflobals-km", "show_connect", show_connect)
	show = 0
	if show_connect and upr then show = 1
	if not(upr) then show = 1
	if show then 
		call "Показ_по_типам" PARAMETERS tip_konstr=tip_konstr RETURNED_PARAMETERS show_type
		show = show_type
	endif
	if show then 
		call "Показ_по_группам" PARAMETERS ALL el_views=el_views RETURNED_PARAMETERS show_el
		show = show_el
	endif
	if show then 
		call "Показ_по_сборкам" PARAMETERS ALL subpos=subpos, pos=pos RETURNED_PARAMETERS show_subpos, show_marker
		show = show_subpos
	endif
	if show then
		success = LIBRARYGLOBAL ("Libraryflobals-km", "show_izd", show_izd)
		success = LIBRARYGLOBAL ("Libraryflobals-km", "show_metall", show_metall)
		if type_spec = "Металл" and not(show_metall) then show = 0
		if type_spec = "Изделие" and not(show_izd) then show = 0
	endif
	if show then
		success = LIBRARYGLOBAL ("Libraryflobals-km", "ignore_id", ignore_id)
		success = LIBRARYGLOBAL ("Libraryflobals-km", "show_ingore", show_ingore)
		show_spec = 0 : IF STRSTR (GLOB_ID, ignore_id, 1) > 0 or type_spec="Не специфицировать" THEN show_spec = 1
		if not(show_ingore) and show_spec then show = 0
	endif
	success = LIBRARYGLOBAL ("Libraryflobals-km", "show_axsis", show_axsis)
	success = LIBRARYGLOBAL ("Libraryflobals-km", "show_only_axsis", show_only_axsis)
	success = LIBRARYGLOBAL ("Libraryflobals-km", "gs_detlevel_3D", gs_detlevel_3D)
	IF gs_detlevel_3D=`Простой` then
		det_lvl_2d = 1
		det_lvl_3d = 1
	endif
	IF gs_detlevel_3D=`Детальный` THEN
		det_lvl_2d = 2
		det_lvl_3d = 2
	endif
	IF gs_detlevel_3D=`Откл` THEN
		det_lvl_2d = 2
		det_lvl_3d = 0
	endif
	if show then
		show_if_vert=1 : show_if_gor=1 : show_if_ang=1
		success = LIBRARYGLOBAL ("Libraryflobals-km", "show_if_vert", show_if_vert)
		success = LIBRARYGLOBAL ("Libraryflobals-km", "show_if_gor", show_if_gor)
		success = LIBRARYGLOBAL ("Libraryflobals-km", "show_if_ang", show_if_ang)
		if el_type_view=1 and not(show_if_gor) and show then show = 0
		if el_type_view=2 and not(show_if_vert) and show then show = 0
		if el_type_view=3 and not(show_if_ang) and show then show = 0
	endif
	show_list = 0 : success = LIBRARYGLOBAL ("Libraryflobals-km", "show_list", show_list)
	if strlen(syst_name)>1 then
		success = LIBRARYGLOBAL ("Libraryflobals-mep", "show_op", show_op)
		call "Показ_систем" PARAMETERS All isMep=0, isEqp=1 RETURNED_PARAMETERS show_el
		if show = 1 and show_el < EPS then show = 0
		if show = 1 and show_op < EPS then show = 0
		if show = 1 then CALL "MEP_m_RequestSystemGlobals" PARAMETERS ALL one_ConID=0 returned_parameters gs_cont_pe, sMat, gs_InsMat
	endif
return

"get_mat":
	success = LIBRARYGLOBAL ("Libraryflobals-km", "mat_by_type_code", mat_by_type_code)
	is_mat_set = 0
	if (show_spec or type_spec = "Не специфицировать") and not(is_mat_set) and mat_by_type_code<>1 then
		ignore_mat = 0
		success = LIBRARYGLOBAL ("Libraryflobals-km", "ignore_mat", ignore_mat)
		col_mat = ignore_mat
		is_mat_set = 1
	endif
	if mat_by_type_code<>1 and not(is_mat_set) then
		if mat_by_type_code=2 then 
			name_mat_arr = "cov_mat_arr"
			inx_mat = cov_mat
		endif
		if mat_by_type_code=3 then
			name_mat_arr = "fire_keep_mat_arr"
			inx_mat = fire_keep_mat
		endif
		if mat_by_type_code=4 then
			name_mat_arr = "konstr_mat_arr"
			inx_mat = type_mat
		endif
		if mat_by_type_code=5 then
			name_mat_arr = "fire_mat_arr"
			inx_mat = fire_mat
		endif
		if mat_by_type_code=6 then
			name_mat_arr = "stal_mat_arr"
			inx_mat = stal_mat
		endif
		if mat_by_type_code=7 then
			name_mat_arr = "type_spec_mat_arr"
			inx_mat = type_spec_mat
		endif
		if mat_by_type_code=8 then
			name_mat_arr = "connect_mat_arr"
			inx_mat = upr_mat
		endif
		if inx_mat=99 or inx_mat<1 then 
			col_mat = 0
		else
			dim cov_mat_arr[]
			success = LIBRARYGLOBAL ("Libraryflobals-km", name_mat_arr, cov_mat_arr)
			col_mat = cov_mat_arr[inx_mat]
		endif
		is_mat_set = 1
	endif
	if strlen(syst_name)>1 then col_mat = sMat
	col_mat = 1
	shadow on
return
]]>
</Script_3D>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_2D SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[
if not(haskey(profile_data.set.path)) then end
if haskey(profile_data.set.el_type_view_2d) then el_type_view = profile_data.set.el_type_view_2d
gosub "set_show_2d"
if not(show) or det_lvl_2d=0 then end
chStoryDist = GLOB_CH_STORY_DIST
IF gs_StorySensitive = 0 THEN chStoryDist = 0
if chStoryDist > EPS then !"Этажом выше"
	gs_cont_pen = gs_cont_pen_up
	gs_fill_type = gs_fill_type_up
	gs_fill_pen = gs_fill_pen_up
	gs_back_pen = gs_back_pen_up
	gs_line_type = gs_line_type_up
	mark = mark_up
endif
if chStoryDist < EPS then
	if abs(chStoryDist) < EPS then !"Собственный этаж"
	else !"Этажом ниже"
		gs_cont_pen = gs_cont_pen_down
		gs_fill_type = gs_fill_type_down
		gs_fill_pen = gs_fill_pen_down
		gs_back_pen = gs_back_pen_down
		gs_line_type = gs_line_type_down
		mark = mark_down
	endif
endif
pen gs_cont_pen
fill gs_fill_type
line_type gs_line_type
SECT_ATTRS gs_fill_type, gs_back_pen, gs_fill_pen, gs_cont_pen, gs_line_type
IF GLOB_FEEDBACK_MODE=1 THEN det_lvl_2d = 1

if el_type_view = 1 then
 
endif
!Вертикальный вид
if el_type_view = 2 then
	if NSP>0 then tt = max(get(nsp))
	tstart = NSP
	for i=1 to vardim1(profile_data.read._2d[det_lvl_2d].unput)
		if not(haskey(profile_data.read._2d[det_lvl_3d].unput[i].s)) then profile_data.read._3d[det_lvl_3d].unput[i].s = 1
		iStatus = profile_data.read._2d[det_lvl_3d].unput[i].s
		if (iStatus > 0) then iStatus = iStatus - iStatus % 100
		_d = 1 : if iStatus = 4000 or iStatus = 2000 then _d = 0
		put profile_data.read._2d[det_lvl_2d].unput[i].x+dx*_d, profile_data.read._2d[det_lvl_2d].unput[i].y+dy_d, profile_data.read._2d[det_lvl_2d].unput[i].s
	next i
	tend = NSP
	n_form = (tend - tstart)/3
	pen gs_cont_pen
	fill gs_fill_type
	for i=1 to vardim1(profile_data.set.start)
		!Смещение
		if haskey(profile_data.set.start[i].x) then
			add2 profile_data.set.start[i].x,0
			n_trans = n_trans + 1
		endif
		if haskey(profile_data.set.start[i].y) then
			add2 0,profile_data.set.start[i].y
			n_trans = n_trans + 1
		endif
		!Поворот
		if haskey(profile_data.set.start[i].rz) then
			rot2 profile_data.set.start[i].rz
			n_trans = n_trans + 1
		endif
		!Отражение
		if haskey(profile_data.set.start[i].mx) then
			if abs(profile_data.set.start[i].mx)>EPS and profile_data.set.start[i].mx<EPS then
				mul2 -1,1
				n_trans = n_trans + 1
			endif
		endif
		if haskey(profile_data.set.start[i].my) then
			if abs(profile_data.set.start[i].my)>EPS and profile_data.set.start[i].my<EPS then
				mul2 1,-1
				n_trans = n_trans + 1
			endif
		endif
		POLY2_b n_form, 1+2+4+8, gs_fill_pen, gs_back_pen,use(n_form*3)
		if n_trans>0 then del n_trans
	next i
	if nsp>0 then tt = max(get(NSP))
endif

if el_type_view = 3 then project2{2} 3, 270, 32+3, gs_back_pen, 0, 0, 90
!project2{2} 3, 270, 32+3, gs_back_pen, 0, 0, 90
end
"set_show_2d":
	show_connect = 1
	success = LIBRARYGLOBAL ("Libraryflobals-km", "show_connect", show_connect)
	show = 0
	if show_connect and upr then show = 1
	if not(upr) then show = 1
	if show then 
		call "Показ_по_типам" PARAMETERS tip_konstr=tip_konstr RETURNED_PARAMETERS show_type
		show = show_type
	endif
	if show then 
		call "Показ_по_группам" PARAMETERS ALL el_views=el_views RETURNED_PARAMETERS show_el
		show = show_el
	endif
	if show then 
		call "Показ_по_сборкам" PARAMETERS ALL subpos=subpos, pos=pos RETURNED_PARAMETERS show_subpos, show_marker
		show = show_subpos
	endif
	if show then
		success = LIBRARYGLOBAL ("Libraryflobals-km", "show_izd", show_izd)
		success = LIBRARYGLOBAL ("Libraryflobals-km", "show_metall", show_metall)
		if type_spec = "Металл" and not(show_metall) then show = 0
		if type_spec = "Изделие" and not(show_izd) then show = 0
	endif
	if show then
		success = LIBRARYGLOBAL ("Libraryflobals-km", "ignore_id", ignore_id)
		success = LIBRARYGLOBAL ("Libraryflobals-km", "show_ingore", show_ingore)
		show_spec = 0 : IF STRSTR (GLOB_ID, ignore_id, 1) > 0 or type_spec="Не специфицировать" THEN show_spec = 1
		if not(show_ingore) and show_spec then show = 0
	endif
	success = LIBRARYGLOBAL ("Libraryflobals-km", "show_axsis", show_axsis)
	success = LIBRARYGLOBAL ("Libraryflobals-km", "show_only_axsis", show_only_axsis)
	success = LIBRARYGLOBAL ("Libraryflobals-km", "gs_detlevel_3D", gs_detlevel_3D)
	IF gs_detlevel_3D=`Простой` then
		det_lvl_2d = 1
		det_lvl_3d = 1
	endif
	IF gs_detlevel_3D=`Детальный` THEN
		det_lvl_2d = 2
		det_lvl_3d = 2
	endif
	IF gs_detlevel_3D=`Откл` THEN
		det_lvl_2d = 2
		det_lvl_3d = 0
	endif
	if show then
		show_if_vert=1 : show_if_gor=1 : show_if_ang=1
		success = LIBRARYGLOBAL ("Libraryflobals-km", "show_if_vert", show_if_vert)
		success = LIBRARYGLOBAL ("Libraryflobals-km", "show_if_gor", show_if_gor)
		success = LIBRARYGLOBAL ("Libraryflobals-km", "show_if_ang", show_if_ang)
		if el_type_view=1 and not(show_if_gor) and show then show = 0
		if el_type_view=2 and not(show_if_vert) and show then show = 0
		if el_type_view=3 and not(show_if_ang) and show then show = 0
	endif
	show_list = 0 : success = LIBRARYGLOBAL ("Libraryflobals-km", "show_list", show_list)
	if strlen(syst_name)>1 then
		success = LIBRARYGLOBAL ("Libraryflobals-mep", "show_op", show_op)
		call "Показ_систем" PARAMETERS All isMep=0, isEqp=1 RETURNED_PARAMETERS show_el
		if show = 1 and show_el < EPS then show = 0
		if show = 1 and show_op < EPS then show = 0
	endif
return
]]>
</Script_2D>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_1D SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[
EPS = 0.0001
flag = 0

tip_konstr = " "
subpos = " "
pos = " "
upr = 0
type_spec = "Металл"

!Смещение оси
dx = 0
dy = 0
el_type_view = 0

dict _dataprof
dict _all
dict _tmp
dict _emp
dict line_dict
dict line_dict_next

if not(haskey(profile_data.set)) then
	text2 0,0,"not(haskey(profile_data.set))"
	goto "m_end"
endif

!Читаем сортамент, если его не передали
gosub "read_sort"

!При необходимости - получаем геометрические данные
gosub "read_profile"

!Если задана точка привязки - получим смещение сечения
if haskey(profile_data.set.cpoint) then
	if profile_data.set.cpoint>=0 and profile_data.set.cpoint<=9 then
		if haskey(profile_data.read.cpoint[profile_data.set.cpoint+1].x) then dx = profile_data.read.cpoint[profile_data.set.cpoint+1].x
		if haskey(profile_data.read.cpoint[profile_data.set.cpoint+1].y) then dy = profile_data.read.cpoint[profile_data.set.cpoint+1].y
	endif
endif

if not(haskey(profile_data.set.path)) then
	if haskey(profile_data.set.coord) then
		gosub "coord2path"
	else
		text2 0,0,"not(haskey(profile_data.set.path))"
		goto "m_end"
	endif
endif

if not(haskey(profile_data.set.start)) then profile_data.set.start[1].x = 0

dlin_prof = 0 : _length = 0
!Определим положение профиля в пространстве - вертикальные, горизонтальный или под наклоном
min_x = 0 : min_y = 0 : min_z = 0
max_x = 0 : max_y = 0 : max_z = 0
for i=1 to vardim1(profile_data.set.path)
	if not(haskey(profile_data.set.path[i].x)) then profile_data.set.path[i].x = 0
	if not(haskey(profile_data.set.path[i].y)) then profile_data.set.path[i].y = 0
	if not(haskey(profile_data.set.path[i].z)) then profile_data.set.path[i].z = 0
	if not(haskey(profile_data.set.path[i].a)) then profile_data.set.path[i].a = 0
	if i>1 and i<vardim1(profile_data.set.path) then
		min_x = min(min_x, profile_data.set.path[i].x)
		max_x = max(max_x, profile_data.set.path[i].x)
		min_y = min(min_y, profile_data.set.path[i].y)
		max_y = max(max_y, profile_data.set.path[i].y)
		min_z = min(min_z, profile_data.set.path[i].z)
		max_z = max(max_z, profile_data.set.path[i].z)
		_length = sqr((profile_data.set.path[i].x-profile_data.set.path[i-1].x)*(profile_data.set.path[i].x-profile_data.set.path[i-1].x) + (profile_data.set.path[i].y-profile_data.set.path[i-1].y)*(profile_data.set.path[i].y-profile_data.set.path[i-1].y))
		dlin_prof = dlin_prof + _length
	endif
next i
ax = 1 : if min_x = max_x then ax = 0
ay = 1 : if min_y = max_y then ay = 0
az = 1 : if min_z = max_z then az = 0
if ax = 0 and ay = 0 and az = 1 and el_type_view = 3 then el_type_view = 2
if (ax = 0 or ay = 0) and az = 0 and el_type_view = 3 then el_type_view = 1


profile_data.read.dlin_prof = dlin_prof

goto "m_end"

"coord2path":
	bb = profile_data.read.bb
	j = 0 : flag_add = 0
	for i=1 to vardim1(profile_data.set.coord)-1
		line_dict_next.start = profile_data.set.coord[i]
		line_dict_next.end = profile_data.set.coord[i+1]
		call "macro_spheric_coord" PARAMETERS line_dict = line_dict_next, bDict = 1, type = 2, RETURNED_PARAMETERS line_dict_next
		!Выступ начала
		if i=2 then 
			call "macro_dotbydr" PARAMETERS line_dict = line_dict, bDict = 1, dr = -0.01, from_dot = 2, RETURNED_PARAMETERS line_dict
			j = j + 1
			profile_data.set.path[j] = line_dict.part
		endif
		if i>1 then
			j = j + 1
			profile_data.set.path[j] = profile_data.set.coord[i-1]
			!Добавление первой промежуточной точки (в начале отрезка), если предыдущий отрезок был под наклоном
			if flag_add then
				kdr = 1 : if abs(line_dict.etta)>EPS then kdr = sin(line_dict.etta) 
				call "macro_dotbydr" PARAMETERS line_dict = line_dict, bDict = 1, dr = bb/kdr, from_dot = 2, RETURNED_PARAMETERS line_dict
				j = j + 1
				profile_data.set.path[j] = line_dict.part
!				profile_data.set.path[j].z = line_dict.end.z
				flag_add = 0
			endif
			!Добавление второй промежуточной точки для текущего отрезка
			if abs(line_dict.etta mod 90)>EPS or abs(line_dict_next.etta mod 90)>EPS then
				kdr = 1 : if abs(line_dict.etta)>EPS then kdr = sin(line_dict.etta)
				call "macro_dotbydr" PARAMETERS line_dict = line_dict, bDict = 1, dr = bb/kdr, from_dot = 1, RETURNED_PARAMETERS line_dict
				j = j + 1
				profile_data.set.path[j] = line_dict.part
!				profile_data.set.path[j].z = line_dict.end.z
				if abs(line_dict_next.etta mod 90)>EPS then
					j = j + 1
					profile_data.set.path[j] = line_dict.end
				endif
				flag_add = 1
			endif
		endif
		line_dict = line_dict_next
		if i=vardim1(profile_data.set.coord)-1 then
			if flag_add then
				kdr = 1 : if abs(line_dict.etta)>EPS then kdr = sin(line_dict.etta)
				call "macro_dotbydr" PARAMETERS line_dict = line_dict, bDict = 1, dr = bb/kdr, from_dot = 2, RETURNED_PARAMETERS line_dict
				j = j + 1
				profile_data.set.path[j] = line_dict.part
!				profile_data.set.path[j].z = line_dict.start.z
				flag_add = 0
			endif
			j = j + 1
			profile_data.set.path[j] = profile_data.set.coord[i+1]
			!Выступ конца
			call "macro_dotbydr" PARAMETERS line_dict = line_dict, bDict = 1, dr = -0.01, from_dot = 1, RETURNED_PARAMETERS line_dict
			j = j + 1
			profile_data.set.path[j] = line_dict.part
		endif
	next i
return

"read_sort":
	if not(haskey(sort_data.isread)) then call "macro_get_sort" PARAMETERS RETURNED_PARAMETERS sort_data
	if haskey(sort_data.isread) then 
		if sort_data.isread = 0 then
			text2 0,0, "Сортамент прочитан с ошибкой"
			goto "m_end"
		endif
	else
		text2 0,0, "Сортамент не прочитан"
		goto "m_end"
	endif
return

"read_profile":
	if not(haskey(profile_data.read)) then 
		profile_data.error = ""
		call "macro_get_profile" PARAMETERS prof_data = profile_data, sort_data = sort_data, RETURNED_PARAMETERS profile_data
		if profile_data.error <> "ok" then
			text2 0,0,profile_data.error
			goto "m_end"
		endif
	endif
return

"m_end":
]]>
</Script_1D>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_PR SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_PR>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_UI SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_UI>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_VL SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[
if haskey(sort_data.isread) then parameters sort_data = sort_data
]]>
</Script_VL>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_FWM SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_FWM>

<!-- GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT ===== GDL SCRIPT -->

<Script_BWM SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Script_BWM>

<ParamSection SectVersion="27" SectionFlags="0" SubIdent="0">
	<ParamSectHeader>
		<AutoHotspots>false</AutoHotspots>
		<StatBits>
			<STBit_FixSize/>
		</StatBits>
		<WDLeftFrame>0</WDLeftFrame>
		<WDRightFrame>0</WDRightFrame>
		<WDTopFrame>0</WDTopFrame>
		<WDBotFrame>0</WDBotFrame>
		<LayFlags>65535</LayFlags>
		<WDMirrorThickness>0</WDMirrorThickness>
		<WDWallInset>0</WDWallInset>
	</ParamSectHeader>
	<Parameters>
		<Length Name="A">
			<Description><![CDATA["Размер 1"]]></Description>
			<Fix/>
			<Value>1</Value>
		</Length>
		<Length Name="B">
			<Description><![CDATA["Размер 2"]]></Description>
			<Fix/>
			<Value>1</Value>
		</Length>
		<Length Name="ZZYZX">
			<Description><![CDATA["Высота"]]></Description>
			<Fix/>
			<Value>1</Value>
		</Length>
		<Boolean Name="AC_show2DHotspotsIn3D">
			<Description><![CDATA["Показыв. 2D-узл.т. в 3D"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Hidden/>
			</Flags>
			<Value>1</Value>
		</Boolean>
		<Length Name="ac_bottomlevel">
			<Description><![CDATA["Уровень внизу"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Hidden/>
			</Flags>
			<Value>1</Value>
		</Length>
		<Length Name="ac_toplevel">
			<Description><![CDATA["Уровень вверху"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Hidden/>
			</Flags>
			<Value>0</Value>
		</Length>

		<!-- all_spec: PARAMETER BLOCK ===== PARAMETER BLOCK ===== PARAMETER BLOCK ===== PARAMETER BLOCK -->

		<Title Name="all_spec">
			<Description><![CDATA["Спецификация"]]></Description>
			<Fix/>
		</Title>
		<String Name="obozn">
			<Description><![CDATA["Обозначение"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value><![CDATA[" "]]></Value>
		</String>
		<String Name="naen">
			<Description><![CDATA["Наименование"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value><![CDATA[" "]]></Value>
		</String>
		<RealNum Name="ves">
			<Description><![CDATA["Масса ед., кг."]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>1</Value>
		</RealNum>
		<Integer Name="kol_vo_spec">
			<Description><![CDATA["Кол-во"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>1</Value>
		</Integer>
		<String Name="komment">
			<Description><![CDATA["Комментарий"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value><![CDATA[" "]]></Value>
		</String>
		<String Name="subpos">
			<Description><![CDATA["Входит в сборку"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value><![CDATA[""]]></Value>
		</String>
		<String Name="tip_el">
			<Description><![CDATA["Тип элемента"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
				<ParFlg_Hidden/>
			</Flags>
			<Value><![CDATA[" "]]></Value>
		</String>
		<String Name="param_name_out">
			<Description><![CDATA[""]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
				<ParFlg_Hidden/>
			</Flags>
			<ArrayValues FirstDimension="2" SecondDimension="0">
				<AVal Row="1"><![CDATA["naen - наименование"]]></AVal>
				<AVal Row="2"><![CDATA["obozn - обозначение"]]></AVal>
			</ArrayValues>
		</String>
		<Boolean Name="show_subpos">
			<Description><![CDATA["Показ по сборкам"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
				<ParFlg_Hidden/>
			</Flags>
			<Value>0</Value>
		</Boolean>
		<Boolean Name="show_marker">
			<Description><![CDATA["Показ маркировки сборки"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
				<ParFlg_Hidden/>
			</Flags>
			<Value>0</Value>
		</Boolean>
		<Boolean Name="manual_elev">
			<Description><![CDATA["Вручную выставить собственный этаж"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>0</Value>
		</Boolean>
		<Integer Name="n_elev">
			<Description><![CDATA["Номер этажа"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>0</Value>
		</Integer>
		<String Name="ur">
			<Description><![CDATA["Уровень"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value><![CDATA[""]]></Value>
		</String>
		<Length Name="ur_num">
			<Description><![CDATA["Уровень числом"]]></Description>
			<Fix/>
			<Value>0</Value>
		</Length>

		<!-- d2vid: PARAMETER BLOCK ===== PARAMETER BLOCK ===== PARAMETER BLOCK ===== PARAMETER BLOCK -->

		<Title Name="d2vid">
			<Description><![CDATA["2D-представление"]]></Description>
			<Fix/>
		</Title>
		<Length Name="krat_txt">
			<Description><![CDATA["Кратность размеров"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>0.001</Value>
		</Length>
		<Integer Name="krat">
			<Description><![CDATA[""]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
				<ParFlg_Hidden/>
			</Flags>
			<Value>1000</Value>
		</Integer>
		<Material Name="gs_ifc_mat">
			<Description><![CDATA["Покрытие IFC"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>53</Value>
		</Material>
		<Boolean Name="gs_StorySensitive">
			<Description><![CDATA["Изменять отображение на других этажах"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>0</Value>
		</Boolean>
		<PenColor Name="gs_cont_pen">
			<Description><![CDATA["Перо контура"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>1</Value>
		</PenColor>
		<PenColor Name="gs_sec_pen">
			<Description><![CDATA["Перо сечения"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>0</Value>
		</PenColor>
		<FillPattern Name="gs_fill_type">
			<Description><![CDATA["Штриховка в плане"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>140</Value>
		</FillPattern>
		<FillPattern Name="gs_fill_type_sec">
			<Description><![CDATA["Штриховка в сечении"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>0</Value>
		</FillPattern>
		<PenColor Name="gs_fill_pen">
			<Description><![CDATA["Перо штриховки"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>1</Value>
		</PenColor>
		<PenColor Name="gs_back_pen">
			<Description><![CDATA["Перо фона штриховки"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>19</Value>
		</PenColor>
		<LineType Name="gs_line_type">
			<Description><![CDATA["Тип линии"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>1</Value>
		</LineType>
		<PenColor Name="gs_cont_pen_up">
			<Description><![CDATA["Перо контура этажом выше"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>1</Value>
		</PenColor>
		<FillPattern Name="gs_fill_type_up">
			<Description><![CDATA["Образец штриховки этажом выше"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>65</Value>
		</FillPattern>
		<PenColor Name="gs_fill_pen_up">
			<Description><![CDATA["Перо штриховки этажом выше"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>1</Value>
		</PenColor>
		<PenColor Name="gs_back_pen_up">
			<Description><![CDATA["Перо фона штриховки этажом выше"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>0</Value>
		</PenColor>
		<LineType Name="gs_line_type_up">
			<Description><![CDATA["Тип линии этажом выше"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>21</Value>
		</LineType>
		<PenColor Name="gs_cont_pen_down">
			<Description><![CDATA["Перо контура этажом ниже"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>1</Value>
		</PenColor>
		<FillPattern Name="gs_fill_type_down">
			<Description><![CDATA["Образец штриховки этажом ниже"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>65</Value>
		</FillPattern>
		<PenColor Name="gs_fill_pen_down">
			<Description><![CDATA["Перо штриховки этажом ниже"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>1</Value>
		</PenColor>
		<PenColor Name="gs_back_pen_down">
			<Description><![CDATA["Перо фона штриховки этажом ниже"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>0</Value>
		</PenColor>
		<LineType Name="gs_line_type_down">
			<Description><![CDATA["Тип линии этажом ниже"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
			</Flags>
			<Value>21</Value>
		</LineType>

		<!-- label_sp: PARAMETER BLOCK ===== PARAMETER BLOCK ===== PARAMETER BLOCK ===== PARAMETER BLOCK -->

		<Title Name="label_sp">
			<Description><![CDATA[""]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Hidden/>
			</Flags>
		</Title>
		<Length Name="label_posxyz">
			<Description><![CDATA["Привязка выносной надписи"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
				<ParFlg_Hidden/>
			</Flags>
			<ArrayValues FirstDimension="3" SecondDimension="0">
				<AVal Row="1">0</AVal>
				<AVal Row="2">0</AVal>
				<AVal Row="3">0</AVal>
			</ArrayValues>
		</Length>
		<Length Name="label_posang">
			<Description><![CDATA["Угла поворота выносной надписи"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
				<ParFlg_Hidden/>
			</Flags>
			<ArrayValues FirstDimension="2" SecondDimension="0">
				<AVal Row="1">0</AVal>
				<AVal Row="2">0</AVal>
			</ArrayValues>
		</Length>
		<Boolean Name="label_posset">
			<Description><![CDATA["Есть данные для передачи в выноску"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
				<ParFlg_Hidden/>
			</Flags>
			<Value>0</Value>
		</Boolean>
		<String Name="label_otm">
			<Description><![CDATA["Типы высотной отметки"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
				<ParFlg_Hidden/>
			</Flags>
			<ArrayValues FirstDimension="1" SecondDimension="0">
				<AVal Row="1"><![CDATA[""]]></AVal>
			</ArrayValues>
		</String>
		<Length Name="label_otm_num">
			<Description><![CDATA["Значения высотной отметки"]]></Description>
			<Fix/>
			<Flags>
				<ParFlg_Child/>
				<ParFlg_Hidden/>
			</Flags>
			<ArrayValues FirstDimension="1" SecondDimension="0">
				<AVal Row="1">0</AVal>
			</ArrayValues>
		</Length>
		<Dictionary Name="sort_data">
			<Description><![CDATA[""]]></Description>
			<Value/>
		</Dictionary>
		<Dictionary Name="profile_data">
			<Description><![CDATA[""]]></Description>
			<Value/>
		</Dictionary>
		<String Name="el_views">
			<Description><![CDATA[""]]></Description>
			<ArrayValues FirstDimension="20" SecondDimension="0">
				<AVal Row="1"><![CDATA[""]]></AVal>
				<AVal Row="2"><![CDATA[""]]></AVal>
				<AVal Row="3"><![CDATA[""]]></AVal>
				<AVal Row="4"><![CDATA[""]]></AVal>
				<AVal Row="5"><![CDATA[""]]></AVal>
				<AVal Row="6"><![CDATA[""]]></AVal>
				<AVal Row="7"><![CDATA[""]]></AVal>
				<AVal Row="8"><![CDATA[""]]></AVal>
				<AVal Row="9"><![CDATA[""]]></AVal>
				<AVal Row="10"><![CDATA[""]]></AVal>
				<AVal Row="11"><![CDATA[""]]></AVal>
				<AVal Row="12"><![CDATA[""]]></AVal>
				<AVal Row="13"><![CDATA[""]]></AVal>
				<AVal Row="14"><![CDATA[""]]></AVal>
				<AVal Row="15"><![CDATA[""]]></AVal>
				<AVal Row="16"><![CDATA[""]]></AVal>
				<AVal Row="17"><![CDATA[""]]></AVal>
				<AVal Row="18"><![CDATA[""]]></AVal>
				<AVal Row="19"><![CDATA[""]]></AVal>
				<AVal Row="20"><![CDATA[""]]></AVal>
			</ArrayValues>
		</String>
		<String Name="syst_name">
			<Description><![CDATA[""]]></Description>
			<Value><![CDATA[""]]></Value>
		</String>
	</Parameters>
</ParamSection>

<Copyright SectVersion="1" SectionFlags="0" SubIdent="0">
	<Author></Author>
	<License>
		<Type>CC BY</Type>
		<Version>4.0</Version>
	</License>
</Copyright>

<Keywords SectVersion="1" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Keywords>

<Comment SectVersion="20" SectionFlags="0" SubIdent="0">
<![CDATA[]]>
</Comment>

</Symbol>




